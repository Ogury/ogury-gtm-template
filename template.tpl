___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Ogury Post Click Tracker",
  "categories": [
    "ADVERTISING",
    "ANALYTICS",
    "PERSONALIZATION"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Ogury Post Click Tracker",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "RADIO",
    "name": "type",
    "displayName": "Type of pixel",
    "radioItems": [
      {
        "value": "js",
        "displayValue": "JS Tag"
      },
      {
        "value": "pixel",
        "displayValue": "Img Tag"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "js"
  },
  {
    "type": "SELECT",
    "name": "event",
    "displayName": "Event to fire",
    "selectItems": [
      {
        "value": "pv",
        "displayValue": "Page View"
      },
      {
        "value": "click",
        "displayValue": "Click"
      },
      {
        "value": "scroll",
        "displayValue": "Scroll"
      },
      {
        "value": "session",
        "displayValue": "Session Duration"
      },
      {
        "value": "custom",
        "displayValue": "Custom"
      }
    ],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "pixel",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "identifier",
    "simpleValueType": true,
    "canBeEmptyString": false,
    "displayName": "Identifier",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "pixel",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Enter your template code here.
const injectScript = require('injectScript');
const setInWindow = require('setInWindow');
const parseUrl = require('parseUrl');
const getUrl = require('getUrl');
const encodeUriComponent = require('encodeUriComponent');
const sendPixel = require('sendPixel');

const full_url = getUrl();
const host = parseUrl(full_url).host || parseUrl(full_url).hostname; 

const type = data.type;

if(type === 'js') {
  const jsUrl = 'https://ads-engagement.presage.io/script?site=' + host + '&full_url=' + encodeUriComponent(full_url);
  injectScript(jsUrl, data.gtmOnSuccess, data.gtmOnFailure, jsUrl);
} 
else if(type === 'pixel') {
  let event = data.custom || data.event;
  let identifier = data.identifier;
  
  const pixelUrl = 'https://ads-engagement.presage.io/pixel?site=' + host + '&e=' + event + (identifier ? ('&id='+ identifier) : '') + '&full_url=' + encodeUriComponent(full_url);
  sendPixel(pixelUrl);
}

// Call data.gtmOnSuccess when the tag is finished.
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": []
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://ads-engagement.presage.io/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://ads-engagement.presage.io/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Should inject the script
  code: |-
    const mockData = {
      // Mocked field values
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 14/12/2023 09:48:08

